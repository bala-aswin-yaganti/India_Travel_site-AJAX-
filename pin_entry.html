<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PIN Entry</title>

  <!-- Bootstrap CSS for styling -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for background, card, and buttons -->
  <style>
    body {
      background-image: url('images/bgimage_home.png'); /* Background image for full page */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      height: 100vh;
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
    }

    /* Dark transparent overlay to improve contrast with background */
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 0;
    }

    /* Glassmorphic styled card container */
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      padding: 40px;
      z-index: 1;
      color: white;
      width: 100%;
      max-width: 500px;
    }

    /* Custom pink-colored button */
    .custom-btn {
      background-color: #ff6f61;
      color: white;
      border: none;
      transition: background-color 0.3s ease;
    }

    .custom-btn:hover {
      background-color: #e85c50;
    }

    /* Style for location list items */
    #locationList li {
      background-color: rgba(255, 255, 255, 0.85);
    }
  </style>
</head>
<body>

<!-- Background overlay for dimming effect -->
<div class="overlay"></div>

<!-- Main container: vertically and horizontally centered -->
<div class="container d-flex flex-column align-items-center justify-content-center vh-100 position-relative">

  <!-- Input card (glassmorphic style) -->
  <div class="glass-card text-center">
    <h1>Discover Places in India</h1>
    <p class="mb-3">Enter your 6-digit PIN code to begin your journey</p>

    <!-- PIN entry form -->
    <form id="pinForm">
      <input type="text" class="form-control mb-2" id="pinInput" placeholder="e.g. 560001" maxlength="6" required />
      
      <!-- Area to show city/state info based on PIN -->
      <div id="cityInfo" class="text-light mb-2 d-none"></div>
      
      <!-- Button to add location -->
      <button type="submit" class="btn custom-btn w-100">Add Location</button>
    </form>

    <!-- Error message display -->
    <div id="errorMsg" class="text-danger mt-3 d-none">Please enter a valid 6-digit PIN code.</div>
  </div>

  <!-- List of added locations -->
  <ul id="locationList" class="list-group mt-4 w-50"></ul>

  <!-- Continue button (visible only when at least one location is added) -->
  <button id="continueBtn" class="btn btn-success mt-3 d-none">Continue</button>
</div>

<!-- JavaScript logic -->
<script>
  // DOM element references
  const pinInput = document.getElementById('pinInput');
  const cityInfo = document.getElementById('cityInfo');
  const errorMsg = document.getElementById('errorMsg');
  const locationList = document.getElementById('locationList');
  const continueBtn = document.getElementById('continueBtn');

  // State variables
  let currentCity = '', currentState = '';
  let locations = [];

  // Listen for input changes in the PIN field
  pinInput.addEventListener('input', async function () {
    const pin = pinInput.value.trim();

    // Check if PIN is a 6-digit number
    if (/^\d{6}$/.test(pin)) {
      try {
        // Fetch city/state from India Postal API
        const response = await fetch(`https://api.postalpincode.in/pincode/${pin}`);
        const data = await response.json();

        // If a valid location is returned
        if (data[0].Status === 'Success') {
          const postOffice = data[0].PostOffice[0];
          currentCity = postOffice.District;
          currentState = postOffice.State;
          cityInfo.classList.remove('d-none');
          cityInfo.textContent = `üìç ${currentCity}, ${currentState}`;
          errorMsg.classList.add('d-none');
        } else {
          resetCurrent(); // reset values and UI if not found
          showError("PIN code not found.");
        }
      } catch (err) {
        resetCurrent();
        showError("Error fetching city. Try again.");
      }
    } else {
      resetCurrent(); // hide city display if input is incomplete
    }
  });

  // Resets city and state info display
  function resetCurrent() {
    cityInfo.classList.add('d-none');
    currentCity = '';
    currentState = '';
  }

  // Show an error message below the form
  function showError(msg) {
    errorMsg.classList.remove('d-none');
    errorMsg.textContent = msg;
  }

  // Handle form submission (Add Location button)
  document.getElementById('pinForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const pin = pinInput.value.trim();

    // If valid PIN and location is fetched
    if (/^\d{6}$/.test(pin) && currentCity !== '') {
      if (locations.length >= 4) {
        showError("You can only add 4 locations.");
        return;
      }

      // Save new location
      const location = { pin, city: currentCity, state: currentState };
      locations.push(location);
      renderList();

      // Clear input and reset current city/state
      pinInput.value = '';
      resetCurrent();

      // Show Continue button once at least one location is added
      if (locations.length >= 1) {
        continueBtn.classList.remove('d-none');
      }
    } else {
      showError("Please enter a valid 6-digit PIN code.");
    }
  });

  // Renders the list of locations below the form
  function renderList() {
    locationList.innerHTML = '';
    locations.forEach((loc, index) => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        ${loc.city}, ${loc.state} (${loc.pin})
        <span>
          <button class="btn btn-sm btn-outline-primary me-2" onclick="moveToTop(${index})">‚¨ÜÔ∏è Top</button>
          <button class="btn btn-sm btn-outline-secondary" onclick="moveToBottom(${index})">‚¨áÔ∏è Bottom</button>
        </span>
      `;
      locationList.appendChild(li);
    });
  }

  // Move location to top of the list
  window.moveToTop = function(index) {
    if (index > 0) {
      const [moved] = locations.splice(index, 1);
      locations.unshift(moved);
      renderList();
    }
  }

  // Move location to bottom of the list
  window.moveToBottom = function(index) {
    if (index < locations.length - 1) {
      const [moved] = locations.splice(index, 1);
      locations.push(moved);
      renderList();
    }
  }

  // On continue button click, redirect to next page with the first pin
  continueBtn.addEventListener('click', () => {
    const mainPin = locations[0].pin;
    window.location.href = `customer_registration.html?pin=${mainPin}`;
  });
</script>

</body>
</html>
